<Window x:Class="ZViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ZViewer - Enhanced Event Log Viewer" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#F8F9FA" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
            <MenuItem Header="_File">
                <MenuItem Header="_Close" Click="Close_Click" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About ZViewer..." Click="About_Click"/>
            </MenuItem>
        </Menu>
        
        <!-- Toolbar -->
        <Border Grid.Row="1" Background="#F0F0F0" Padding="10,5">
            <StackPanel Orientation="Horizontal">
                <Button Content="🔄 Refresh" Width="80" Height="30" 
                        Margin="0,0,10,0" Command="{Binding RefreshCommand}"/>
                <ProgressBar Width="auto" Height="20" Margin="150,0,0,0"
                            Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                            IsIndeterminate="True"/>
            </StackPanel>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Sidebar -->
            <Border Grid.Column="0" Background="#F8F9FA" BorderBrush="#E0E0E0" BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Event Logs" FontWeight="Bold" 
                              Margin="10,10,10,5" FontSize="14"/>

                    <TreeView Grid.Row="1" Name="LogTreeView" Margin="5" 
                             SelectedItemChanged="LogTreeView_SelectedItemChanged"
                             BorderThickness="0">
                        <TreeView.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Filter Current Log..." Click="FilterCurrentLog_Click"/>
                                <MenuItem Name="ClearFilterMenuItem" Header="Clear Filter" Click="ClearFilter_Click" 
                                    Visibility="{Binding IsFilterApplied, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                <Separator Visibility="{Binding IsFilterApplied, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                <Separator/>
                                <MenuItem Header="Save All Events As..." Click="SaveAllEvents_Click"/>
                                <MenuItem Name="SaveFilteredMenuItem" Header="Save Filtered Log File As..." Click="SaveFilteredEvents_Click"
                                    Visibility="{Binding IsFilterApplied, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                <Separator/>
                                <MenuItem Header="Properties" Click="Properties_Click"/>
                            </ContextMenu>
                        </TreeView.ContextMenu>
                        <TreeView.Resources>
                            <Style TargetType="TreeViewItem">
                                <Setter Property="IsExpanded" Value="True"/>
                                <Setter Property="Padding" Value="3"/>
                            </Style>
                        </TreeView.Resources>

                        <TreeViewItem Header="Windows Logs" FontWeight="Bold">
                            <TreeViewItem Header="Application" Tag="Application"/>
                            <TreeViewItem Header="Security" Tag="Security"/>
                            <TreeViewItem Header="Setup" Tag="Setup"/>
                            <TreeViewItem Header="System" Tag="System"/>
                        </TreeViewItem>
                        <TreeViewItem Header="All Logs" Tag="All" FontWeight="Bold"/>
                    </TreeView>
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" Background="#E0E0E0"/>

            <!-- Right Content -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="2*"/>
                    <RowDefinition Height="5"/>
                    <RowDefinition Height="1*"/>
                </Grid.RowDefinitions>

                <!-- Current Log Header -->
                <Border Grid.Row="0" Background="#F0F0F0" Padding="10,5" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                    <TextBlock Text="{Binding CurrentLogDisplayText}" FontWeight="Bold" FontSize="12"/>
                </Border>

                <!-- Data Grid -->
                <DataGrid Grid.Row="1" ItemsSource="{Binding EventsView}"
                          SelectedItem="{Binding SelectedEvent}"
                          AutoGenerateColumns="False" IsReadOnly="True"
                          GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                          SelectionMode="Single" CanUserSortColumns="True"
                          CanUserReorderColumns="True"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.VirtualizationMode="Recycling"
                          EnableRowVirtualization="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Level" Binding="{Binding Level}" Width="80"/>
                        <DataGridTextColumn Header="Date and Time" Binding="{Binding TimeCreated, StringFormat='yyyy-MM-dd HH:mm:ss'}" Width="140"/>
                        <DataGridTextColumn Header="Source" Binding="{Binding Source}" Width="200"/>
                        <DataGridTextColumn Header="Event ID" Binding="{Binding EventId}" Width="80"/>
                        <DataGridTextColumn Header="Task Category" Binding="{Binding TaskCategory}" Width="150"/>
                        <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*"/>
                    </DataGrid.Columns>
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Level}" Value="Critical">
                                    <Setter Property="Background" Value="#FFEBEE"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Level}" Value="Error">
                                    <Setter Property="Background" Value="#FFEBEE"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Level}" Value="Warning">
                                    <Setter Property="Background" Value="#FFF8E1"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>

                <!-- Horizontal Splitter -->
                <GridSplitter Grid.Row="2" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="#E0E0E0"/>

                <!-- Event Details Panel -->
                <Border Grid.Row="3" Background="White" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
                    <Grid Visibility="{Binding HasSelectedEvent, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Details Header -->
                        <Border Grid.Row="0" Background="#F8F9FA" Padding="10,5" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                            <TextBlock Text="Event Properties" FontWeight="Bold" FontSize="11"/>
                        </Border>

                        <!-- Tab Control -->
                        <TabControl Grid.Row="1" Margin="5">
                            <!-- General Tab -->
                            <TabItem Header="General">
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <Grid Margin="10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Log Name:" FontWeight="Bold" Margin="0,0,10,5"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SelectedEvent.LogName}" Margin="0,0,0,5"/>

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Source:" FontWeight="Bold" Margin="0,0,10,5"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SelectedEvent.Source}" Margin="0,0,0,5"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Event ID:" FontWeight="Bold" Margin="0,0,10,5"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SelectedEvent.EventId}" Margin="0,0,0,5"/>

                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Level:" FontWeight="Bold" Margin="0,0,10,5"/>
                                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SelectedEvent.Level}" Margin="0,0,0,5"/>

                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Date and Time:" FontWeight="Bold" Margin="0,0,10,5"/>
                                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding SelectedEvent.TimeCreated, StringFormat='dddd, MMMM dd, yyyy h:mm:ss tt'}" Margin="0,0,0,5"/>

                                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Task Category:" FontWeight="Bold" Margin="0,0,10,10" VerticalAlignment="Top"/>
                                        <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding SelectedEvent.TaskCategory}" Margin="0,0,0,10"/>

                                        <TextBlock Grid.Row="6" Grid.Column="0" Text="Description:" FontWeight="Bold" Margin="0,0,10,10" VerticalAlignment="Top"/>
                                        <TextBox Grid.Row="6" Grid.Column="1" Text="{Binding SelectedEvent.Description, Mode=OneWay}" 
                                                 IsReadOnly="True" BorderThickness="0" Background="Transparent"
                                                 TextWrapping="Wrap" Margin="0,0,0,10"/>
                                    </Grid>
                                </ScrollViewer>
                            </TabItem>

                            <!-- Details Tab (XML) -->
                            <TabItem Header="Details">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <!-- XML View Options (like Event Viewer) -->
                                    <Border Grid.Row="0" Background="#F8F9FA" Padding="5" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                                        <StackPanel Orientation="Horizontal">
                                            <RadioButton Content="Friendly View" IsEnabled="False" Margin="0,0,15,0"/>
                                            <RadioButton Content="XML View" IsChecked="True"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- XML Content -->
                                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" 
                      Background="White" Margin="5">
                                        <TextBox Text="{Binding SelectedEventXml, Mode=OneWay}" 
                     IsReadOnly="True" 
                     BorderThickness="0"
                     Background="White"
                     FontFamily="Consolas"
                     FontSize="11"
                     TextWrapping="NoWrap"
                     Margin="10"
                     Foreground="#2E3440"/>
                                    </ScrollViewer>
                                </Grid>
                            </TabItem>
                        </TabControl>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="#F0F0F0" Padding="10,5">
            <TextBlock Text="{Binding StatusText}" VerticalAlignment="Center"/>
        </Border>
    </Grid>
</Window>